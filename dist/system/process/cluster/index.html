<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/black-node-guidebook/umi.css" />
    <script>
      window.routerBase = "/black-node-guidebook/";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>集群 cluster - Node Guidebook</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/system/process/cluster" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/black-node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/black-node-guidebook//overview">概览</a></span><span><a href="/black-node-guidebook//engine">引擎</a></span><span><a aria-current="page" class="active" href="/black-node-guidebook//system">系统</a></span><span><a href="/black-node-guidebook//network">网络</a></span><span><a href="/black-node-guidebook//server-application">服务端应用</a></span><span><a href="/black-node-guidebook//util-application">工具应用</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/yyt520/black-node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/black-node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/black-node-guidebook//overview">概览</a></li><li><a href="/black-node-guidebook//engine">引擎</a></li><li><a aria-current="page" class="active" href="/black-node-guidebook//system">系统</a></li><li><a href="/black-node-guidebook//network">网络</a></li><li><a href="/black-node-guidebook//server-application">服务端应用</a></li><li><a href="/black-node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/yyt520/black-node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">进程</a><ul><li><a href="/black-node-guidebook//system/process/process"><span>进程 process</span></a></li><li><a href="/black-node-guidebook//system/process/child-process"><span>子进程 child_process</span></a></li><li><a aria-current="page" class="active" href="/black-node-guidebook//system/process/cluster"><span>集群 cluster</span></a></li><li><a href="/black-node-guidebook//system/process/ipc"><span>进程间通信</span></a></li><li><a href="/black-node-guidebook//system/process/daemon"><span>守护进程</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">异步 I/O</a><ul><li><a href="/black-node-guidebook//system/io/io"><span>概述</span></a></li><li><a href="/black-node-guidebook//system/io/buffer"><span>Buffer 缓冲器</span></a></li><li><a href="/black-node-guidebook//system/io/stream"><span>Stream 流</span></a></li><li><a href="/black-node-guidebook//system/io/readable-stream"><span>ReadableStream 可读流</span></a></li><li><a href="/black-node-guidebook//system/io/writable-stream"><span>WritableStream 可写流</span></a></li><li><a href="/black-node-guidebook//system/io/duplex-stream"><span>DuplexStream 双工流</span></a></li><li><a href="/black-node-guidebook//system/io/transform-stream"><span>TransformStream 转换流</span></a></li><li><a href="/black-node-guidebook//system/io/string-decoder"><span>StringDecoder 字符串解码</span></a></li><li><a href="/black-node-guidebook//system/io/path"><span>Path 路径</span></a></li><li><a href="/black-node-guidebook//system/io/filesystem"><span>File 文件系统</span></a></li><li><a href="/black-node-guidebook//system/io/console"><span>Console 控制台</span></a></li></ul></li><li><a href="/black-node-guidebook//system/process">进程</a><ul><li><a href="/black-node-guidebook//system/process/multiple-process-architecture"><span>多进程架构模型</span></a></li><li><a href="/black-node-guidebook//system/process/tmp"><span>Node.js 中的进程与线程</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="集群创建" data-depth="2"><a href="/black-node-guidebook//system/process/cluster#集群创建"><span>集群创建</span></a></li><li title="运作原理" data-depth="2"><a href="/black-node-guidebook//system/process/cluster#运作原理"><span>运作原理</span></a></li><li title="进程间通信" data-depth="3"><a href="/black-node-guidebook//system/process/cluster#进程间通信"><span>进程间通信</span></a></li><li title="端口共享" data-depth="3"><a href="/black-node-guidebook//system/process/cluster#端口共享"><span>端口共享</span></a></li><li title="分发连接" data-depth="3"><a href="/black-node-guidebook//system/process/cluster#分发连接"><span>分发连接</span></a></li><li title="集群的可伸缩性策略" data-depth="2"><a href="/black-node-guidebook//system/process/cluster#集群的可伸缩性策略"><span>集群的可伸缩性策略</span></a></li><li title="克隆" data-depth="3"><a href="/black-node-guidebook//system/process/cluster#克隆"><span>克隆</span></a></li><li title="分解" data-depth="3"><a href="/black-node-guidebook//system/process/cluster#分解"><span>分解</span></a></li><li title="拆分" data-depth="3"><a href="/black-node-guidebook//system/process/cluster#拆分"><span>拆分</span></a></li><li title="内部通信技巧" data-depth="2"><a href="/black-node-guidebook//system/process/cluster#内部通信技巧"><span>内部通信技巧</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="集群"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#集群"><span class="icon icon-link"></span></a>集群</h1><p>Node 实例是单线程作业的。在服务端编程中，通常会创建多个 Node 实例来处理客户端的请求，以此提升系统的吞吐率。对这样多个 Node 实例，我们称之为 Cluster（集群）。</p><p>借助 Node.js 的 <code>cluster</code> 模块，开发者可以在几乎不修改原有项目代码的前提下，获得集群服务带来的好处。</p><p>集群有以下两种常见的实现方案：</p><p><strong>方案一：多个 Node 实例+多个端口</strong></p><p>集群内的 Node.js 实例，各自监听不同的端口，再由反向代理实施请求到多个端口的分发。</p><ul><li>优点：实现简单，各实例相对独立，这对服务稳定性有好处</li><li>缺点：增加端口占用，进程之间通信比较麻烦</li></ul><p><strong>方案二：主进程向子进程转发请求</strong></p><p>集群内，创建一个主进程（master），以及若干个子进程（worker）。由 <code>master</code> 监听客户端连接请求，并根据特定的策略，转发至对应的 <code>worker</code>。而这种方案为 Node.js 的 <code>cluster</code> 模式所使用。</p><ul><li>优点：通常只占用一个端口，通信相对简单，转发策略更灵活</li><li>缺点：实现相对复杂，对主进程的稳定性要求较高</li></ul><h2 id="集群创建"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#集群创建"><span class="icon icon-link"></span></a>集群创建</h2><p>Cluster 是常见的 Node.js 利用多核的方法，它是基于 <code>child_process.fork()</code> 实现的，所以 <code>cluster</code> 产生的进程之间是通过 <a href="/black-node-guidebook//system/process/ipc">IPC</a> 来通信的，并且它也没有拷贝父进程的空间，而是通过加入 <code>cluster.isMaster</code> 这个标识，来区分父进程以及子进程，达到类似 POSIX 的 fork 的效果。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> cluster </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;cluster&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">            </span><span class="token comment">// | |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> http </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;http&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">                  </span><span class="token comment">// | |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> numCPUs </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;os&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span><span class="token plain">   </span><span class="token comment">// | |    都执行了</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                                               </span><span class="token comment">// | |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">cluster</span><span class="token punctuation">.</span><span class="token property-access">isMaster</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">                        </span><span class="token comment">// |-|-----------------</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Fork workers.                             //   |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> numCPUs</span><span class="token punctuation">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">          </span><span class="token comment">//   |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    cluster</span><span class="token punctuation">.</span><span class="token method function property-access">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">                            </span><span class="token comment">//   |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain">                                            </span><span class="token comment">//   | 仅父进程执行 (master.js)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  cluster</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;exit&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">worker</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">             </span><span class="token comment">//   |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">worker</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">process</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">pid</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string"> died</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">//   |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">                                          </span><span class="token comment">//   |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">                                       </span><span class="token comment">// |-------------------</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Workers can share any TCP connection      // |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// In this case it is an HTTP server         // |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  http</span><span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req，res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">            </span><span class="token comment">// |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    res</span><span class="token punctuation">.</span><span class="token method function property-access">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">                        </span><span class="token comment">// |   仅子进程执行 (worker.js)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    res</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello world!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">                   </span><span class="token comment">// |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">                             </span><span class="token comment">// |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain">                                              </span><span class="token comment">// |-------------------</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                                               </span><span class="token comment">// | |</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello world!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain">                   </span><span class="token comment">// | |    都执行了</span></div></pre></div><p>在上述代码中 <code>numCPUs</code> 虽然是全局变量但是，在父进程中修改它，子进程中并不会改变，因为父进程与子进程是完全独立的两个空间。他们所谓的共有仅仅只是都执行了，并不是同一份。</p><p>你可以把父进程执行的部分当做 <code>master.js</code>，子进程执行的部分当做 <code>worker.js</code>，你可以把他们想象成是先执行了 <code>node master.js</code> 然后 <code>cluster.fork</code> 了几次，就执行了几次 <code>node worker.js</code>。而 cluster 模块则是二者之间的一个桥梁，你可以通过 cluster 提供的方法，让其二者之间进行沟通交流。</p><h2 id="运作原理"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#运作原理"><span class="icon icon-link"></span></a>运作原理</h2><p>了解 cluster 模块，主要需要搞清楚三个问题：</p><ol><li>master 和 <code>worker</code> 如何通信？</li><li>多个 server 实例，如何实现端口共享？</li><li>多个 server 实例，来自客户端的请求如何分发到多个 worker？</li></ol><h3 id="进程间通信"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#进程间通信"><span class="icon icon-link"></span></a>进程间通信</h3><blockquote><p><code>master</code> 和 <code>worker</code> 如何通信？</p></blockquote><p><code>master</code> 进程通过 <code>cluster.fork()</code> 来创建 <code>worker</code> 进程。<code>cluster.fork()</code> 内部是通过<code>child_process.fork()</code> 方法创建的。</p><p>也就是说：</p><ol><li><code>master</code> 进程和 <code>worker</code> 进程是父子进程的关系</li><li><code>master</code> 进程和 <code>worker</code> 进程可以通过 IPC 通道进行通信相互传递服务句柄 📌</li></ol><h3 id="端口共享"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#端口共享"><span class="icon icon-link"></span></a>端口共享</h3><blockquote><p>多个 <code>server</code> 实例，如何实现端口共享？</p></blockquote><p>在前面的例子中，多个 <code>worker</code> 中创建的 <code>server</code> 监听了相同的端口 3000。通常来说，多个进程监听同个端口，系统会报错。</p><p>那么为什么我们的示例没问题呢？</p><p>这是因为在 net 模块中，会根据当前进程是 <code>master</code> 进程还是 <code>worker</code> 进程，对 <code>listen()</code> 方法进行了特殊处理：</p><ol><li><code>master</code> 进程：在该端口上正常监听请求（没做特殊处理）</li><li><code>worker</code> 进程：创建 Server 实例。然后通过 IPC 通道，向 <code>master</code> 进程发送消息，让 <code>master</code> 进程页创建 server 实例，并在该端口上监听请求。当请求进来时，<code>master</code> 进程将请求转发给 worker 进程的 server 实例。</li></ol><p>归纳起来，就是：<code>master</code> 进程监听特定端口，并将客户请求转发给 <code>worker</code> 进程。</p></div><img alt="Cluster模块运行流程" src="/black-node-guidebook/static/cluster-run-flow.23451d03.png" width="640"/><div class="markdown"><h3 id="分发连接"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#分发连接"><span class="icon icon-link"></span></a>分发连接</h3><blockquote><p>多个 <code>server</code> 实例，来自客户端的请求如何分发到多个 <code>worker</code>？</p></blockquote><p>每当 <code>worker</code> 进程创建 <code>server</code> 实例来监听请求，都会通过 IPC 通道，在 <code>master</code> 上进行注册。当客户端请求到达，<code>master</code> 会负责将请求转发给对应的 <code>worker</code>。</p><p>具体转发给哪个 <code>worker</code>？这是由转发策略决定的。可以通过环境变量 <code>NODE_CLUSTER_SCHED_POLICY</code> 设置，也可以在 <code>cluster.setupMaster(options)</code> 时传入。</p><p>cluster 模块提供了两种分发连接的方式。</p><p>第一种方式（默认方式，不适用于 Windows），通过<strong>时间片轮转法</strong>（round-robin）分发连接。主进程监听端口，接收到新连接之后，通过时间片轮转法来决定将接收到的客户端的 Socket 句柄传递给指定的 <code>worker</code> 处理。至于每个连接由哪个 <code>worker</code> 来处理，完全由内置的循环算法决定。</p><p>第二种方式是由主进程创建 <code>socket</code> 监听端口后，将 socket 句柄直接分发给相应的 <code>worker</code>，然后当连接进来时，就直接由相应的 <code>worker</code> 来接收连接并处理。</p><p>使用第二种方式时理论上性能应该较高，然而时间上存在负载不均衡的问题，比如通常 70% 的连接仅被 8 个进程中的 2 个处理，而其他进程比较清闲。</p><h2 id="集群的可伸缩性策略"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#集群的可伸缩性策略"><span class="icon icon-link"></span></a>集群的可伸缩性策略</h2><p>Node.js 中的伸缩性是融合到运行时核心的特性。Node 被命名为 Node 是为了强调 Node 应用应该包含多个相互之间通信的小型分布式节点。</p><p>Node.js 的 <code>cluster</code> 模块不仅提供了充分利用机器 CPU 内核开箱即用的解决方案，还有助于 Node 进程增加可用性的能力，另外还提供了一个选项：无停机重启整个应用的能力。</p><p>工作量是我们扩展应用的最普遍的理由，但同时我们也通过扩展应用增加可用性和容灾能力。</p><p>实际上，主要通过以下三种策略提高应用的可伸缩性。</p><h3 id="克隆"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#克隆"><span class="icon icon-link"></span></a>克隆</h3><p>扩展大型应用最简单的方法就是多次克隆并且克隆实例处理负载的一部分（例如使用负载均衡器）。并不会花费太多的开发事件并且非常有效。策略就是做最小化的事情并且 Node.js 有内置模块 <code>cluster</code>，在服务器上面实现一个克隆策略非常容易。</p><h3 id="分解"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#分解"><span class="icon icon-link"></span></a>分解</h3><p>我们可以基于功能和服务通过分解扩展一个应用。这意味着用不同的代码实现多样的应用，有时候有专属的数据库和用户界面。</p><p>这种策略通常与 <strong>微服务（Microservice）</strong> 有关，<strong>微</strong>指的是这些服务应该尽可能地小，但是实际上，最重要的不是服务的大小，而是服务之间的松耦合和高内聚。这个策略的实现并不容易并且可能导致长期的出乎意料的问题，但是做好之后，有点还是非常大的。</p><h3 id="拆分"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#拆分"><span class="icon icon-link"></span></a>拆分</h3><p>我们可以将应用分成多个实例，每个实例负责应用数据的一部分。这个策略是在数据库上 <strong>水平切分（horizontal paritioning）</strong>，或者<strong>分区（sharding）</strong>。数据分区在每个操作使用哪个应用实例之前需要有一个查找的步骤。例如也许我们通过用户的国家和语言进行分区，那么我们就需要一个数据信息的查找。</p><h2 id="内部通信技巧"><a aria-hidden="true" tabindex="-1" href="/black-node-guidebook//system/process/cluster#内部通信技巧"><span class="icon icon-link"></span></a>内部通信技巧</h2><p>在开发过程中，我们会通过 <code>process.on(&#x27;message&#x27;, fn)</code> 来实现进程间通信。</p><p>前面提到，master 进程、worker 进程在 server 实例的创建过程中，也是通过 IPC 通道进行通信的。那会不会对我们的开发造成干扰呢？比如，收到一堆其实并不需要关心的信息？</p><p>答案肯定是不会，那么是怎么实现的呢？</p><p>当发送的消息包含 <code>cmd</code> 字段，且改字段以 <code>NODE_</code> 作为前缀，则该消息会被视为内部包括保留的消息，不会通过 <code>message</code> 事件抛出，但可以通过监听 <code>internalMessage</code> 捕获。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// worker 进程</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> message </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">cmd</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;NODE_CLUSTER&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token literal-property property">act</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;queryServer&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">process</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token plain">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><hr/><p><strong>参考资料：</strong></p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/chyingp/nodejs-learning-guide/blob/master/%E6%A8%A1%E5%9D%97/cluster.md">📝 node-learning-guide: cluster<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="http://www.alloyteam.com/2015/08/nodejs-cluster-tutorial/">📝 腾讯 AlloyTeam：解读 Node.js 的 cluster 模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://mp.weixin.qq.com/s/Xm_c841UdKA06s76rJ_4nw">📝 猫眼前端：深入浅出 Node.js Cluster<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/36728299">📝 Node.js 集群（cluster）：扩展你的 Node.js 应用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/41118827">📝 Node.js：浅析高并发与分布式集群<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://fed.taobao.org/blog/2015/11/04/nodejs-cluster/">📝 淘宝前端：当我们谈论 cluster 时我们在谈论什么<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://www.cnblogs.com/accordion/p/7207740.html">📝 Node.js cluster 模块深入研究<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><hr/><ul><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/74879045">理解 Node.js 中的多线程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/77733656">深入理解 Node.js 进程与线程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/165131406">多进程 &amp; Node.js Web 实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/36728299">Node.js 集群（Cluster）：扩展你的 Node.js 应用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/28319632">Node.js Cluster 模块深入研究<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/34912873">Node.js 源码阅读：多进程架构的演进之路与 eggjs 多进程架构实践<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/128066894">EggCluster 是如何解决多进程模式下相关问题的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/100550801">Node 多进程的创建与维护<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/181729061">nodejs 创建线程问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/61807318">Nodejs 单线程为什么能支持高并发？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/220478526">如何解决 nodejs 中 cpu 密集型的任务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/52455566">Node.js 真·多线程 Worker Threads 初探<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://zhuanlan.zhihu.com/p/35353355">Node 黑魔法之无痛用线上多线程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/yyt520/black-node-guidebook/edit/master/docs/system/process/cluster.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">2023/7/9 19:47:35</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/black-node-guidebook/umi.js"></script>
  </body>
</html>
